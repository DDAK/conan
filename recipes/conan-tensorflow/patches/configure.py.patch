diff --git a/configure.py b/configure.py
index 8ec47294b4..d71eb85038 100644
--- a/configure.py
+++ b/configure.py
@@ -1186,14 +1186,22 @@ def set_system_libs_flag(environ_cp):
       syslibs = ','.join(sorted(syslibs.split(',')))
     else:
       syslibs = ','.join(sorted(syslibs.split()))
-    write_action_env_to_bazelrc('TF_SYSTEM_LIBS', syslibs)
-
-  if 'PREFIX' in environ_cp:
-    write_to_bazelrc('build --define=PREFIX=%s' % environ_cp['PREFIX'])
-  if 'LIBDIR' in environ_cp:
-    write_to_bazelrc('build --define=LIBDIR=%s' % environ_cp['LIBDIR'])
-  if 'INCLUDEDIR' in environ_cp:
-    write_to_bazelrc('build --define=INCLUDEDIR=%s' % environ_cp['INCLUDEDIR'])
+    write_action_env_to_bazelrc('TF_SYSTEM_LIBS', syslibs.strip())
+
+  print ("syslibs is {}".format(syslibs))
+  for component in syslibs.split(','):
+    component = component.strip()
+    prefix = component + "_PREFIX"
+    libdir = component + "_LIBDIR"
+    includedir = component + "_INCLUDEDIR"
+
+    print("Setting up component {} as follows {}, {}, {}".format(component, prefix, libdir, includedir))
+    if prefix in environ_cp:
+      write_to_bazelrc('build --define=%s=%s' % (prefix, environ_cp[prefix]))
+    if libdir in environ_cp:
+      write_to_bazelrc('build --define=%s=%s' % (libdir, environ_cp[libdir]))
+    if includedir in environ_cp:
+      write_to_bazelrc('build --define=%s=%s' % (includedir, environ_cp[includedir]))
 
 
 def is_reduced_optimize_huge_functions_available(environ_cp):
